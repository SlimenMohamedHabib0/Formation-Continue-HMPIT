<div *ngIf="loading" class="text-center py-6">
    <div class="spinner-border text-primary"></div>
  </div>
  
  <div *ngIf="dashboard" class="page-body dashboard-wrap">
    <div class="dashboard-header mb-4">
      <div class="page-title">Dashboard Administrateur</div>
      <div class="dashboard-subtitle">
        Vue globale de la plateforme
      </div>
    </div>
  
    <div class="kpi-grid mb-4">
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/utilisateurs')" (keydown.enter)="go('/admin/utilisateurs')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Utilisateurs</div>
            <span class="badge bg-primary-lt">USER</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbUsers }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/professeurs')" (keydown.enter)="go('/admin/professeurs')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Professeurs</div>
            <span class="badge bg-primary-lt">PROF</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbProfessors }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/utilisateurs')" (keydown.enter)="go('/admin/utilisateurs')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Administrateurs</div>
            <span class="badge bg-indigo-lt">ADMIN</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbAdmins }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/categories')" (keydown.enter)="go('/admin/categories')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Catégories</div>
            <span class="badge bg-azure-lt">CAT</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbCategories }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/supervision')" (keydown.enter)="go('/admin/supervision')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Cours (total)</div>
            <span class="badge bg-primary-lt">ALL</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbCoursesTotal }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/supervision')" (keydown.enter)="go('/admin/supervision')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Cours (brouillons)</div>
            <span class="badge bg-orange-lt">DRAFT</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbCoursesDraft }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/supervision')" (keydown.enter)="go('/admin/supervision')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Cours (publiés)</div>
            <span class="badge bg-green-lt">LIVE</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbCoursesPublished }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/supervision')" (keydown.enter)="go('/admin/supervision')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Inscriptions (total)</div>
            <span class="badge bg-azure-lt">TOTAL</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbEnrollmentsTotal }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/supervision')" (keydown.enter)="go('/admin/supervision')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Inscriptions (en attente)</div>
            <span class="badge bg-yellow-lt">PENDING</span>
          </div>
          <div class="kpi-value">{{ dashboard.nbEnrollmentsPending }}</div>
        </div>
      </div>
  
      <div class="card dashboard-kpi" role="button" tabindex="0" (click)="go('/admin/supervision')" (keydown.enter)="go('/admin/supervision')">
        <div class="card-body">
          <div class="kpi-top">
            <div class="kpi-label">Taux de réussite</div>
            <span class="badge bg-primary-lt">SCORE</span>
          </div>
          <div class="kpi-value">{{ dashboard.successRatePercent | number:'1.0-2' }}%
</div>
        </div>
      </div>
    </div>
  
    <div class="row row-cards mb-4">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Inscriptions — Détails</div>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-4">
                <div class="mini-label">Acceptées</div>
                <div class="mini-value">{{ dashboard.nbEnrollmentsAccepted }}</div>
              </div>
              <div class="col-4">
                <div class="mini-label">Refusées</div>
                <div class="mini-value">{{ dashboard.nbEnrollmentsRefused }}</div>
              </div>
              <div class="col-4">
                <div class="mini-label">En attente</div>
                <div class="mini-value">{{ dashboard.nbEnrollmentsPending }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      



      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <div class="card-title">QCM — Résultats</div>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-3">
                <div class="mini-label">Total</div>
                <div class="mini-value">{{ dashboard.nbAttemptsTotal }}</div>
              </div>
              <div class="col-3">
                <div class="mini-label">Réussies</div>
                <div class="mini-value">{{ dashboard.nbAttemptsPassed }}</div>
              </div>
              <div class="col-3">
                <div class="mini-label">Échouées</div>
                <div class="mini-value">{{ dashboard.nbAttemptsFailed }}</div>
              </div>
              <div class="col-3">
                <div class="mini-label">Moyenne (/20)</div>
                <div class="mini-value">{{ dashboard.averageNote | number:'1.0-2' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <div class="row row-cards">
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Top cours</div>
              <div class="card-subtitle">Par inscriptions</div>
            </div>
          </div>
    
          <div class="table-responsive">
            <table class="table table-vcenter card-table table-clean table-compact">
              <thead>
                <tr>
                  <th style="width: 60px;">#</th>
                  <th class="text-center">Cours</th>
                  <th class="text-end" style="width: 148px;">Inscriptions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="!dashboard.topCoursesByEnrollments?.length">
                  <td colspan="3" class="text-secondary px-4 py-4">Aucun résultat.</td>
                </tr>
    
                <tr *ngFor="let item of dashboard.topCoursesByEnrollments; let i = index" class="row-hover">
                  <td class="text-secondary fw-bold">{{ i + 1 }}</td>
                  <td class="fw-semibold text-center"><span class="name-cell">{{ item.label }}</span></td>
                  <td class="text-center fw-bold" style="width: 148px;">{{ item.count }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Top catégories</div>
              <div class="card-subtitle">Par nombre de cours</div>
            </div>
          </div>
    
          <div class="table-responsive">
            <table class="table table-vcenter card-table table-clean table-compact">
              <thead>
                <tr>
                  <th style="width: 60px;">#</th>
                  <th class="text-center">Catégorie</th>
                  <th class="text-end" style="width: 89px;">Cours</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="!dashboard.topCategoriesByCourses?.length">
                  <td colspan="3" class="text-secondary px-4 py-4">Aucun résultat.</td>
                </tr>
    
                <tr *ngFor="let item of dashboard.topCategoriesByCourses; let i = index" class="row-hover">
                  <td class="text-secondary fw-bold">{{ i + 1 }}</td>
                  <td class="fw-semibold text-center"><span class="name-cell">{{ item.label }}</span></td>
                  <td class="text-center fw-bold">{{ item.count }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Top catégories</div>
              <div class="card-subtitle">Par inscriptions</div>
            </div>
          </div>
    
          <div class="table-responsive">
            <table class="table table-vcenter card-table table-clean table-compact">
              <thead>
                <tr>
                  <th style="width: 60px;">#</th>
                  <th class="text-center">Catégorie</th>
                  <th class="text-end" style="width: 148px;">Inscriptions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="!dashboard.topCategoriesByEnrollments?.length">
                  <td colspan="3" class="text-secondary px-4 py-4">Aucun résultat.</td>
                </tr>
    
                <tr *ngFor="let item of dashboard.topCategoriesByEnrollments; let i = index" class="row-hover">
                  <td class="text-secondary fw-bold">{{ i + 1 }}</td>
                  <td class="fw-semibold text-center"><span class="name-cell">{{ item.label }}</span></td>
                  <td class="text-center fw-bold" style="width: 148px;">{{ item.count }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row row-cards mt-3">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Top services</div>
              <div class="card-subtitle">Par inscriptions (acceptées)</div>
            </div>
          </div>
    
          <div class="table-responsive">
            <table class="table table-vcenter card-table table-clean table-compact">
              <thead>
                <tr>
                  <th style="width: 60px;">#</th>
                  <th class="text-center">Service</th>
                  <th class="text-end" style="width: 148px;">Inscriptions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="!dashboard.topServicesByEnrollments?.length">
                  <td colspan="3" class="text-secondary px-4 py-4">Aucun résultat.</td>
                </tr>
    
                <tr *ngFor="let item of dashboard.topServicesByEnrollments; let i = index" class="row-hover">
                  <td class="text-secondary fw-bold">{{ i + 1 }}</td>
                  <td class="fw-semibold text-center"><span class="name-cell">{{ item.label }}</span></td>
                  <td class="text-center fw-bold" style="width: 148px;">{{ item.count }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Top statuts</div>
              <div class="card-subtitle">Par inscriptions (acceptées)</div>
            </div>
          </div>
    
          <div class="table-responsive">
            <table class="table table-vcenter card-table table-clean table-compact">
              <thead>
                <tr>
                  <th style="width: 60px;">#</th>
                  <th class="text-center">Statut</th>
                  <th class="text-end" style="width: 148px;">Inscriptions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="!dashboard.topStatutsByEnrollments?.length">
                  <td colspan="3" class="text-secondary px-4 py-4">Aucun résultat.</td>
                </tr>
    
                <tr *ngFor="let item of dashboard.topStatutsByEnrollments; let i = index" class="row-hover">
                  <td class="text-secondary fw-bold">{{ i + 1 }}</td>
                  <td class="fw-semibold text-center"><span class="name-cell">{{ item.label }}</span></td>
                  <td class="text-center fw-bold" style="width: 148px;">{{ item.count }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
  </div>
  